!function(e){"use strict";let n;!function(e){e.TRACKING_ACCEPTED="trackingConsentAccepted",e.TRACKING_DECLINED="trackingConsentDeclined",e.MARKETING_ACCEPTED="firstPartyMarketingConsentAccepted",e.SALE_OF_DATA_ACCEPTED="thirdPartyMarketingConsentAccepted",e.ANALYTICS_ACCEPTED="analyticsConsentAccepted",e.PREFERENCES_ACCEPTED="preferencesConsentAccepted",e.MARKETING_DECLINED="firstPartyMarketingConsentDeclined",e.SALE_OF_DATA_DECLINED="thirdPartyMarketingConsentDeclined",e.ANALYTICS_DECLINED="analyticsConsentDeclined",e.PREFERENCES_DECLINED="preferencesConsentDeclined",e.CONSENT_COLLECTED="visitorConsentCollected",e.CONSENT_TRACKING_API_LOADED="consentTrackingApiLoaded"}(n||(n={}));let t,o,r,c,i,s,a,u;!function(e){e.ACCEPTED="yes",e.DECLINED="no",e.NO_INTERACTION="no_interaction",e.NO_VALUE=""}(t||(t={})),function(e){e.NO_VALUE="",e.ACCEPTED="1",e.DECLINED="0"}(o||(o={})),function(e){e.GDPR="GDPR",e.CCPA="CCPA",e.NO_VALUE=""}(r||(r={})),function(e){e.PREFERENCES="p",e.ANALYTICS="a",e.MARKETING="m",e.SALE_OF_DATA="t"}(c||(c={})),function(e){e.GDPR="GDPR",e.GDPR_BLOCK_ALL="GDPR_BLOCK_ALL",e.CCPA="CCPA",e.CMP="CMP"}(i||(i={})),function(e){e.MARKETING="m",e.ANALYTICS="a",e.PREFERENCES="p",e.SALE_OF_DATA="s"}(s||(s={})),function(e){e.MARKETING="marketing",e.ANALYTICS="analytics",e.PREFERENCES="preferences",e.SALE_OF_DATA="sale_of_data",e.EMAIL="email"}(a||(a={})),function(e){e.HEADLESS_STOREFRONT="headlessStorefront",e.ROOT_DOMAIN="rootDomain",e.CHECKOUT_ROOT_DOMAIN="checkoutRootDomain",e.STOREFRONT_ROOT_DOMAIN="storefrontRootDomain",e.STOREFRONT_ACCESS_TOKEN="storefrontAccessToken"}(u||(u={}));const l=["lim","v","con","reg"];function E(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function A(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?E(Object(t),!0).forEach((function(n){f(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):E(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function f(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}let C={};function d(e){const n=document.cookie?document.cookie.split("; "):[];C[e]=void 0;for(let t=0;t<n.length;t++){const[o,r]=n[t].split("=");if(e===decodeURIComponent(o))return C[e]=JSON.parse(decodeURIComponent(r)),C[e]}}function p(e,n){if(null===n)return;C[e]=void 0;let t,o,r=document.head.querySelector("meta[name=".concat(n,"]"));if(r instanceof HTMLMetaElement){t=r.content;try{const e=t.replace(/1/g,"true").replace(/0/g,"false"),n=e.split(";").map(e=>e.trim()).map(e=>e.split("=").map(e=>e.trim()));if(o=Object.fromEntries(n),o.purposes){const e=o.purposes.split(/(true|false)/).filter(Boolean),n={};for(let t=0;t<e.length;t+=2)n[e[t]]=JSON.parse(e[t+1]);o.purposes=n}for(let[e,n]of Object.entries(o))"true"===n&&(o[e]=!0),"false"===n&&(o[e]=!1)}catch(e){return}return C[e]=o,o}}function T(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e in C||d(e)||p(e,n),C[e]}function N(e){return e===encodeURIComponent(decodeURIComponent(e))}function _(e,n,t,o){if(!N(o))throw new TypeError("Cookie value is not correctly URI encoded.");if(!N(e))throw new TypeError("Cookie name is not correctly URI encoded.");let r="".concat(e,"=").concat(o);r+="; path=/",r+="; domain=".concat(n),r+="; expires=".concat(new Date((new Date).getTime()+t).toUTCString()),r+="; secure",document.cookie=r,C[e]=JSON.parse(decodeURIComponent(o))}function D(){const e=T("_tracking_consent");if(void 0!==e&&!function(e){if("2.1"!==e.v)return!0;return!function(e,n){const t=n.slice().sort();return e.length===n.length&&e.slice().sort().every((e,n)=>e===t[n])}(Object.keys(e).filter(e=>"region"!==e),l)}(e))return e}function O(){try{let e=D();if(!e)return;return e}catch(e){return}}function g(){return{m:h(s.MARKETING),a:h(s.ANALYTICS),p:h(s.PREFERENCES),s:h(s.SALE_OF_DATA)}}function R(){return g()[s.SALE_OF_DATA]}function S(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===e&&(e=O()),void 0===e}function y(e){switch(e){case o.ACCEPTED:return t.ACCEPTED;case o.DECLINED:return t.DECLINED;default:return t.NO_VALUE}}function I(e){switch(e){case s.ANALYTICS:return a.ANALYTICS;case s.MARKETING:return a.MARKETING;case s.PREFERENCES:return a.PREFERENCES;case s.SALE_OF_DATA:return a.SALE_OF_DATA}}function h(e){const n=O();if(!n)return o.NO_VALUE;const t=n.con.CMP;return t?t[e]:o.NO_VALUE}function w(){return T("_cmp_a","shopify-cmp-metadata")}function L(e){const n=w();if(!n)return!0;const t=n.purposes[e];return"boolean"!=typeof t||t}function P(){return L(c.PREFERENCES)}function m(){return L(c.ANALYTICS)}function b(){return L(c.MARKETING)}function k(){return L(c.SALE_OF_DATA)}function v(){const e=w();return!!e&&("boolean"==typeof e.display_banner&&e.display_banner)}function M(){const e=w();return e&&e.sale_of_data_region||!1}function F(e){void 0!==e.consent?j({[c.PREFERENCES]:e.consent,[c.ANALYTICS]:e.consent,[c.MARKETING]:e.consent,[c.SALE_OF_DATA]:e.consent}):void 0!==e.granular_consent&&j({[c.PREFERENCES]:P(),[c.ANALYTICS]:m(),[c.MARKETING]:b(),[c.SALE_OF_DATA]:k()})}function G(e,n){document.dispatchEvent(new CustomEvent(e,{detail:n||{}}))}function j(e){const t=e[c.MARKETING],o=e[c.SALE_OF_DATA],r=e[c.ANALYTICS],i=e[c.PREFERENCES];!0===t?G(n.MARKETING_ACCEPTED):!1===t&&G(n.MARKETING_DECLINED),!0===o?G(n.SALE_OF_DATA_ACCEPTED):!1===o&&G(n.SALE_OF_DATA_DECLINED),!0===r?G(n.ANALYTICS_ACCEPTED):!1===r&&G(n.ANALYTICS_DECLINED),!0===i?G(n.PREFERENCES_ACCEPTED):!1===i&&G(n.PREFERENCES_DECLINED);const s=function(e){return{marketingAllowed:e[c.MARKETING],saleOfDataAllowed:e[c.SALE_OF_DATA],analyticsAllowed:e[c.ANALYTICS],preferencesAllowed:e[c.PREFERENCES],firstPartyMarketingAllowed:e[c.MARKETING],thirdPartyMarketingAllowed:e[c.SALE_OF_DATA]}}(e);G(n.CONSENT_COLLECTED,s);const a=[r,i,t,o];a.every(e=>!0===e)&&G(n.TRACKING_ACCEPTED),a.every(e=>!1===e)&&G(n.TRACKING_DECLINED)}function K(e,n){const t=new XMLHttpRequest,o=JSON.stringify(e);t.open("POST","/set_tracking_consent.json",!0),t.setRequestHeader("Content-Type","application/json"),t.onreadystatechange=function(){if(4!==t.readyState)return;C={};const o=function(e){try{return JSON.parse(e)}catch(e){return{error:"Unknown error"}}}(t.responseText);var r;0===(r=t.status)||200>=r&&r<400?(F(e),n(null,o)):n(o)},t.send(o)}function U(e){const n=JSON.stringify({marketing:e.marketing,analytics:e.analytics,preferences:e.preferences,saleOfData:e.sale_of_data}).replace(/"/g,"");return{query:"query { consentManagement { cookies(visitorConsent: ".concat(n,") { answersCookie trackingConsentCookie } } }"),variables:{}}}function Y(e,n){const t=e.granular_consent,o={headers:{"content-type":"application/json","x-shopify-storefront-access-token":t.storefrontAccessToken},body:JSON.stringify(U(t)),method:"POST"};fetch("https://".concat(t.checkoutRootDomain,"/api/unstable/graphql.json"),o).then(e=>{if(e.ok)return e.json();throw new Error("Server error")}).then(o=>{const r="."+(t.checkoutRootDomain||window.location.hostname),c="."+(t.storefrontRootDomain||window.location.hostname),i=o.data.consentManagement.cookies.trackingConsentCookie,s=o.data.consentManagement.cookies.answersCookie;_("_tracking_consent",r,31536e6,i),_("_cmp_a",r,31536e6,s),c!==r&&(_("_tracking_consent",c,31536e6,i),_("_cmp_a",c,31536e6,s)),F(e),n(null,o)}).catch(e=>{n({error:"Error while setting headless consent: "+e.message})})}function B(e,n){if(S()&&console.warn("Shop is not configured to block privacy regulation in online store settings."),function(e){if("boolean"!=typeof e&&"object"!=typeof e)throw TypeError("setTrackingConsent must be called with a boolean or object consent value");if("object"==typeof e){const n=Object.keys(e);if(0===n.length)throw TypeError("The submitted consent object is empty.");const t=[a.MARKETING,a.ANALYTICS,a.PREFERENCES,a.SALE_OF_DATA,a.EMAIL,u.ROOT_DOMAIN,u.CHECKOUT_ROOT_DOMAIN,u.STOREFRONT_ROOT_DOMAIN,u.STOREFRONT_ACCESS_TOKEN,u.HEADLESS_STOREFRONT];for(const e of n)if(!t.includes(e))throw TypeError("The submitted consent object should only contain the following keys: ".concat(t.join(", "),". Extraneous key: ").concat(e,"."))}}(e),"function"!=typeof n)throw TypeError("setTrackingConsent must be called with a callback function");if("object"==typeof e){const t=x(e.analytics),o=X(e.analytics);return(e.storefrontAccessToken?Y:K)(A(A({granular_consent:e},null!==t&&{referrer:t}),null!==o&&{landing_page:o}),n)}{const t=x(e),o=X(e);return K(A(A({consent:e},null!==t&&{referrer:t}),null!==o&&{landing_page:o}),n)}}function V(e,n){if("boolean"!=typeof e)throw TypeError("setCCPAConsent must be called with a boolean consent value");if("function"!=typeof n)throw TypeError("setCCPAConsent must be called with a callback function");return K({ccpa_consent:e},n)}function q(){if(S())return t.NO_VALUE;const e=g();return e[s.MARKETING]===o.ACCEPTED&&e[s.ANALYTICS]===o.ACCEPTED?t.ACCEPTED:e[s.MARKETING]===o.DECLINED||e[s.ANALYTICS]===o.DECLINED?t.DECLINED:t.NO_INTERACTION}function H(){const e=function(){const e=O();return S(e)?r.NO_VALUE:e.reg}();return e in r?e:r.NO_VALUE}function J(){return console.warn("getShopPrefs is deprecated and will be removed."),{limit:[]}}function x(e){return e?z()?document.referrer:"":null}function X(e){return e?z()?window.location.pathname+window.location.search:"/":null}function z(){if(""===document.referrer)return!0;const e=document.createElement("a");return e.href=document.referrer,window.location.hostname!=e.hostname}function Q(){return console.warn("isRegulationEnforced is deprecated and will be removed."),!0}function W(){return!!S()||b()&&m()}function Z(){return M()?"string"==typeof navigator.globalPrivacyControl?"1"!==navigator.globalPrivacyControl:"boolean"==typeof navigator.globalPrivacyControl?!navigator.globalPrivacyControl:null:null}function $(){return console.warn("userDataCanBeSold is deprecated and will be replaced with saleOfDataAllowed."),k()}function ee(){return v()&&q()===t.NO_INTERACTION}function ne(){return!1===Z()?t.DECLINED:(e=R(),S()?t.NO_VALUE:e===o.NO_VALUE?t.NO_INTERACTION:y(e));var e}function te(){return console.warn("shouldShowCCPABanner is deprecated and will be removed."),M()&&ne()===t.NO_INTERACTION}function oe(){return!0}function re(e,n,t){try{var o;!function(e){const n=new XMLHttpRequest;n.open("POST","https://notify.bugsnag.com/",!0),n.setRequestHeader("Content-Type","application/json"),n.setRequestHeader("Bugsnag-Api-Key","95ba910bcec4542ef2a0b64cd7ca666c"),n.setRequestHeader("Bugsnag-Payload-Version","5");const t=function(e){const n=function(e){return e.stackTrace||e.stack||e.description||e.name}(e.error),[t,o]=(n||"unknown error").split("\n")[0].split(":");return JSON.stringify({payloadVersion:5,notifier:{name:"ConsentTrackingAPI",version:"latest",url:"-"},events:[{exceptions:[{errorClass:(t||"").trim(),message:(o||"").trim(),stacktrace:[{file:"consent-tracking-api.js",lineNumber:"1",method:n}],type:"browserjs"}],context:e.context||"general",app:{id:"ConsentTrackingAPI",version:"latest"},metaData:{request:{shopId:e.shopId,shopUrl:window.location.href},device:{userAgent:window.navigator.userAgent},"Additional Notes":e.notes},unhandled:!1}]})}(e);n.send(t)}({error:e,context:n,shopId:ie()||(null===(o=window.Shopify)||void 0===o?void 0:o.shop),notes:t})}catch(e){}}function ce(e){return function(){try{return e(...arguments)}catch(e){throw re(e),e}}}function ie(){try{const e=document.getElementById("shopify-features").textContent;return JSON.parse(e).shopId}catch(e){return null}}function se(){return b()}function ae(){return k()}function ue(){const e={},n=g();for(const t of Object.keys(n))e[I(t)]=y(n[t]);return e}function le(e,n){return"object"==typeof e&&e.headlessStorefront&&!e.storefrontAccessToken?function(e,n){function t(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.NO_VALUE;return!0===e?o.ACCEPTED:!1===e?o.DECLINED:n}const c={[s.ANALYTICS]:t(e[a.ANALYTICS],o.DECLINED),[s.MARKETING]:t(e[a.MARKETING],o.DECLINED),[s.PREFERENCES]:t(e[a.PREFERENCES],o.DECLINED),[s.SALE_OF_DATA]:t(e[a.SALE_OF_DATA])},u={v:"2.1",reg:r.NO_VALUE,lim:[i.CMP],con:{CMP:c}},l=encodeURIComponent(JSON.stringify(u));_("_tracking_consent",e.rootDomain,31536e6,l),n(null)}(e,n):B(e,n)}const Ee=e=>{let{useBugsnagReporting:n}=e;R()!=o.DECLINED&&!1===Z()&&V(!1,()=>!1);const t={getTrackingConsent:q,setTrackingConsent:le,userCanBeTracked:W,getRegulation:H,isRegulationEnforced:Q,getShopPrefs:J,shouldShowGDPRBanner:ee,userDataCanBeSold:$,setCCPAConsent:V,getCCPAConsent:ne,shouldShowCCPABanner:te,doesMerchantSupportGranularConsent:oe,analyticsProcessingAllowed:m,preferencesProcessingAllowed:P,marketingAllowed:se,firstPartyMarketingAllowed:se,saleOfDataAllowed:ae,thirdPartyMarketingAllowed:ae,currentVisitorConsent:ue,shouldShowBanner:v,saleOfDataRegion:M,unstable:{analyticsProcessingAllowed:m,preferencesProcessingAllowed:P,marketingAllowed:se,saleOfDataAllowed:ae,currentVisitorConsent:ue,shouldShowBanner:v,saleOfDataRegion:M}};if(!n)return t;const r=["unstable"];for(const e in t)t.hasOwnProperty(e)&&(t[e]=r.includes(e)?t[e]:ce(t[e]));return t};function Ae(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{useBugsnagReporting:!1};return Ee(e)}function fe(){window.Shopify.customerPrivacy=window.Shopify.trackingConsent=Ae({useBugsnagReporting:!0}),G(n.CONSENT_TRACKING_API_LOADED)}window.Shopify=window.Shopify?window.Shopify:{},fe(),e.default=Ae,e.setGlobalObject=fe,Object.defineProperty(e,"__esModule",{value:!0})}({});
//# sourceMappingURL=consent-tracking-api.js.map
